<h2>About</h2>
<p>This is a product tour library built with Angular (2+). It's inspired by
  <a tourAnchor="angular-ui-tour" href="http://benmarch.github.io/angular-ui-tour">angular-ui-tour</a>.</p>
<p>
  <code>TourMatMenuModule</code> is an implementation of the tour ui that uses
  <a href="http://material.angular.io">Angular Material</a> MatMenu to display tour steps.</p>

<h2 tourAnchor="installation">Installation</h2>
<ol>
  <li>
    <code>npm install ngx-ui-tour-core ngx-ui-tour-md-menu @angular/animations @angular/cdk @angular/http @angular/material</code>
  </li>
  <li>Import
    <code>TourMatMenuModule.forRoot()</code> into your app module</li>
  <li>Make sure
    <code>RouterModule</code> is imported in your app module</li>
  <li>Make sure Angular Material is
    <a href="https://material.angular.io/guide/getting-started">installed correctly</a>
  </li>
</ol>

<h2 tourAnchor="usage">Usage</h2>

<h4>Simple project</h4>
<ol>
  <li>Add
    <code>&lt;tour-step-template&gt;&lt;/tour-step-template&gt;</code> to your root app component</li>
  <li>
    Define anchor points for the tour steps by adding the
    <code>tourAnchor</code> directive throughout your app.
    <pre><code>&lt;div tourAnchor="some.anchor.id"&gt;...&lt;/div&gt;</code></pre>
  </li>
  <li>
    Define your tour steps using
    <code>tourService.initialize(steps)</code>
    <pre>
this.tourService.initialize([{{ '{' }}
  anchorId: 'some.anchor.id',
  content: 'Some content',
  title: 'First',
}, {{ '{' }}
  anchorId: 'another.anchor.id',
  content: 'Other content',
  title: 'Second',
}]);</pre>
  </li>
  <li>Start the tour with
    <code tourAnchor="tourService.start">tourService.start()</code>
  </li>
  <li>Check out the
    <a href="https://github.com/hakimio/ngx-ui-tour/tree/master/src/app/md-menu">demo source code</a> for an example.</li>
</ol>

<h4>Lazy loaded modules</h4>

<ol>

  <li>
    Add
    <pre><code>&lt;tour-step-template&gt;&lt;/tour-step-template&gt;</code></pre> to your root app component.
  </li>
  <li>
    Import
    <pre><code>TourMatMenuModule.forRoot()</code></pre> into your app module.
  </li>
  <li>
    Import
    <pre><code>TourMatMenuModule</code></pre> into all lazy loaded modules needing the tour.
  </li>
  <li>
    Import the
    <pre><code>TourService</code></pre> in your highest level eagerly loaded component and initialize all your steps there (even the ones in the lazy loaded
    modules).
    <strong>Note:</strong>
    Make sure every step object contains its route. For example, if the route to a step is '/home' then your step object should
    have
    <code>route: '/home'</code> as a member.
  </li>
  <li>
    Define anchor points for your steps by adding the
    <pre><code>tourAnchor</code></pre> directive throughout your modules (any component that requires it at any level).
    <pre><code>&lt;div tourAnchor="some.anchor.id"&gt;...&lt;/div&gt;</code></pre>
  </li>
  <li>
    Start the tour with
    <pre><code>tourService.start()</code></pre> in the same component you initialized your steps. Call this right after the initialization.
  </li>
  <li>Check out the
    <a href="https://github.com/hakimio/ngx-ui-tour/tree/master/src/app/md-menu/mat-lazy-tour">demo source code</a> for an example.
  </li>

</ol>

<h2>FAQ</h2>

<h4>How to center tour step?</h4>

<p>You can create an invisible anchor point for the tour step you want to center.</p>
<ol>
  <li>Add a simple div to your html template which will be used as the tour anchor
    <pre><code>
&lt;div class=&quot;centered-tour-element&quot; tourAnchor=&quot;start-tour&quot;&gt;&lt;/div&gt;
    </code></pre>
  </li>
  <li>
    Add CSS for the div
    <pre><code>
.centered-tour-element {{"{"}}
  position: fixed;
  left: 50%;
  top: 50%;
  /* The anchor should be translated to the left by half of your step width and half height  */
  /* For example, if your tour step has dimensions of 280 Ã— 156 px, you have to translate by (-140px, -78px) */
  transform: translate(-140px, -78px);
{{"}"}}
    </code></pre>
  </li>
  <li>
    Use previously defined tour anchor
    <pre><code>
this.tourService.initialize([{{"{"}}
  anchorId: 'start-tour',
  title: 'Welcome',
  content: 'Welcome to the Ngx-UI-Tour tour!'
{{"}"}}]);
this.tourService.start();
    </code></pre>
  </li>
</ol>

<h4>How to disable main content scrolling when UI tour is active?</h4>
<p>You can toggle CSS class which disables main content element scrolling when tour starts/ends.</p>
<ol>
  <li>
    Create custom <code>TourService</code>:
    <pre><code>
@Injectable()
export class MyTourService {{"{"}}

  constructor(
    private readonly tourService: TourService
  ) {{"{"}}{{"}"}}

  private readonly MAIN_SECTION_CSS_SELECTOR = 'section.main-content';
  private readonly NO_SCROLL_CSS_CLASS = 'no-scroll';

  start(steps: IStepOption[]) {{"{"}}
    this.tourService.initialize(steps, {{"{"}}
      route: 'my-route',
      enableBackdrop: true
    {{"}"}});
    this.tourService.end$.subscribe(() => this.setIsScrollable(true));
    this.setIsScrollable(false);
    this.tourService.start();
  {{"}"}}

  private setIsScrollable(isScrollable: boolean) {{"{"}}
    const body = document.body,
      mainSection = document.querySelector(this.MAIN_SECTION_CSS_SELECTOR),
      addOrRemove = isScrollable ? 'remove' : 'add';

    mainSection.classList[addOrRemove](this.NO_SCROLL_CSS_CLASS);
    // You can also optionally disable iOS Safari bounce effect
    body[addOrRemove + 'EventListener']('touchmove', this.preventTouchMove, {{"{"}} passive: false });
  {{"}"}}

  private preventTouchMove(e) {{"{"}}
    e.preventDefault();
  {{"}"}}

{{"}"}}
    </code></pre>
  </li>
  <li>
    Add the <code>no-scroll</code> CSS class to your global stylesheet (<code>styles.(s)css</code>)
    <pre><code>
.no-scroll {{"{"}}
  overflow: hidden;
{{"}"}}
    </code></pre>
  </li>
  <li>
    Use your custom <code>TourService</code> to start the UI tour:
    <pre><code>
import {{"{"}}MyTourService{{"}"}} from '@app-utils/my-tour.service';

@Component({{"{"}}
  selector: 'my-app',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
{{"}"}})
export class AppComponent {{"{"}}

  constructor(
    private readonly myTourService: MyTourService
  ) {{"{"}}
    this.myTourService.start([{{"{"}}
      anchorId: 'start-tour',
      title: 'Welcome',
      content: 'Welcome to the Ngx-UI-Tour tour!'
    {{"}"}}]);
  {{"}"}}

{{"}"}}
    </code></pre>
  </li>
</ol>

<h2>TourService</h2>
<p>The
  <code>TourService</code> controls the tour. Some key functions include:</p>
<dl>
  <dt>start()</dt>
  <dd>Starts the tour</dd>
  <dt>startAt(stepId: number | string)</dt>
  <dd>Start the tour at the step with stepId or at the specified index</dd>
  <dt>end()</dt>
  <dd>Ends the tour</dd>
  <dt>pause()</dt>
  <dd>Pauses the tour</dd>
  <dt>resume()</dt>
  <dd>Resumes the tour</dd>
  <dt>next()</dt>
  <dd>Goes to the next step</dd>
  <dt>prev()</dt>
  <dd>Goes to the previous step</dd>
</dl>

<h2>Step Configuration</h2>
<p>Each step can have the following properties.</p>
<table class="table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>stepId</td>
      <td>string</td>
      <td>""</td>
      <td>A unique identifier for the step</td>
    </tr>
    <tr tourAnchor="config.anchorId">
      <td>anchorId</td>
      <td>string</td>
      <td>required</td>
      <td>The anchor to which the step will be attached</td>
    </tr>
    <tr>
      <td>title</td>
      <td>string</td>
      <td>""</td>
      <td>The title of the tour step</td>
    </tr>
    <tr>
      <td>content</td>
      <td>string</td>
      <td>""</td>
      <td>The content text of the tour step</td>
    </tr>
    <tr tourAnchor="config.enableBackdrop">
      <td>enableBackdrop</td>
      <td>boolean</td>
      <td>false</td>
      <td>Controls whether to enable active element highlighting</td>
    </tr>
    <tr tourAnchor="config.route">
      <td>route</td>
      <td>string | UrlSegment[]</td>
      <td>undefined</td>
      <td>
        The route to which the tour should navigate before attempting to show this tour step. If undefined, no navigation is attempted.
      </td>
    </tr>
    <tr tourAnchor="config.nextStep">
      <td>nextStep</td>
      <td>number | string</td>
      <td>undefined</td>
      <td>The step index or stepId of the next step. If undefined, the next step in the steps array is used.</td>
    </tr>
    <tr>
      <td>prevStep</td>
      <td>number | string</td>
      <td>undefined</td>
      <td>The step index or stepId of the previous step. If undefined, the previous step in the steps array is used.</td>
    </tr>
    <tr>
      <td>
        <del>placement</del>
      </td>
      <td>N/A</td>
      <td>N/A</td>
      <td>
        Ignored by
        <code>TourMatMenuModule</code>
      </td>
    </tr>
    <tr>
      <td>preventScrolling</td>
      <td>boolean</td>
      <td>false</td>
      <td>
        Tour steps automatically scroll to the middle of the screen, if they are off the screen when shown. Setting this value to
        true will disable the scroll behavior.
      </td>
    </tr>
    <tr tourAnchor="config.buttons.custom">
      <td>prevBtnTitle</td>
      <td>string</td>
      <td>false</td>
      <td>
        Sets a custom prev button title for a given step. Default is "Prev"
      </td>
    </tr>
    <tr>
      <td>nextBtnTitle</td>
      <td>string</td>
      <td>false</td>
      <td>
        Sets a custom next button title for a given step. Default is "Next"
      </td>
    </tr>
    <tr>
      <td>endBtnTitle</td>
      <td>string</td>
      <td>false</td>
      <td>
        Sets a custom end button title for a given step. Default is "End"
      </td>
    </tr>
    <tr>
      <td>waitFor</td>
      <td>Promise | Observable</td>
      <td>undefined</td>
      <td>
        [Deprecated: use "isAsync" instead]
        Waits for the given Promise or Observable before showing the step contents.
      </td>
    </tr>
    <tr tourAnchor="config.isAsync" *ngIf="showIsAsyncConfig">
      <ng-container >
        <td>isAsync</td>
        <td>boolean</td>
        <td>false</td>
        <td>
          Mark your step as async if anchor element is added to DOM with a delay (ie after data is loaded).
        </td>
      </ng-container>
    </tr>
    <tr>
      <td colspan="4" *ngIf="isLoading && !showIsAsyncConfig">
        <strong>Loading data...</strong>
      </td>
      <td colspan="4" *ngIf="!isLoading" tourAnchor="config.fakeData">
        Fake data: {{fakeData | json}}
      </td>
    </tr>
  </tbody>
</table>

<h2>Defaults</h2>
<p>You can set default values in the
  <code>TourService.initialize</code> function.</p>
<pre>
this.tourService.initialize(steps, {{ '{' }}
  route: '',
  preventScrolling: true,
});
</pre>
<p>Any value explicitly defined in a step will override the default value.</p>

<h2 tourAnchor="hotkeys">Hotkeys</h2>
<p>
  Hotkeys are provided using Angular's
  <code>@HostListener</code> decorator. Hotkeys are enabled when the tour starts and disabled when the tour ends.
</p>
<ul>
  <li>
    <strong>left arrow</strong>
    <span> - previous step</span>
  </li>
  <li>
    <strong>right arrow</strong>
    <span> - next step</span>
  </li>
  <li>
    <strong>esc</strong>
    <span> - end tour</span>
  </li>
</ul>
<p>
  You can disable hotkeys by calling
  <code>tourService.disableHotkeys()</code> or re-enable with
  <code>tourService.enableHotkeys()</code>
</p>

<h2 tourAnchor="events">Event Observables</h2>
<p>The
  <code>TourService</code> emits events that can be subscribed to like this:</p>
<pre>
this.tourService.initialize$.subscribe((steps: IStepOption[]) => {{ '{' }}
  console.log('tour configured with these steps:', steps);
});
</pre>
<table class="table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Payload</th>
      <th>Emitted When</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>stepShow$</td>
      <td>IStepOption</td>
      <td>A step is shown</td>
    </tr>
    <tr>
      <td>stepHide$</td>
      <td>IStepOption</td>
      <td>A step is hidden</td>
    </tr>
    <tr>
      <td>initialize$</td>
      <td>IStepOption[]</td>
      <td>The tour is configured with a set of steps</td>
    </tr>
    <tr>
      <td>start$</td>
      <td>IStepOption</td>
      <td>The tour begins</td>
    </tr>
    <tr>
      <td>end$</td>
      <td>any</td>
      <td>The tour ends</td>
    </tr>
    <tr>
      <td>pause$</td>
      <td>IStepOption</td>
      <td>The tour is paused</td>
    </tr>
    <tr>
      <td>resume$</td>
      <td>IStepOption</td>
      <td>The tour resumes</td>
    </tr>
    <tr>
      <td>anchorRegister$</td>
      <td>string</td>
      <td>An anchor is registered with the tour</td>
    </tr>
    <tr>
      <td>anchorUnregister$</td>
      <td>string</td>
      <td>An anchor is unregistered from the tour</td>
    </tr>
    <tr>
      <td>startWaiting$</td>
      <td>IStepOption</td>
      <td>Starts waiting for async step ("isAsync" or "waitFor" configs set)</td>
    </tr>
    <tr>
      <td>stopWaiting$</td>
      <td>IStepOption</td>
      <td>Async anchor is registered or "waitFor" config Promise/Observable completes</td>
    </tr>
  </tbody>
</table>

<h2 tourAnchor="template">Custom template</h2>
<p>
  You can also customize the tour step template by providing an
  <code>&lt;ng-template let-step="step" &gt;</code> inside the
  <code>&lt;tour-step-template&gt;</code>
</p>
<p>
  The default template is equivalent to this:
</p>
<pre><code>&lt;tour-step-template&gt;
  &lt;ng-template let-step="step"&gt;
    &lt;mat-card (click)="$event.stopPropagation()"&gt;
      &lt;mat-card-title&gt;
        {{ '{{' }}step?.title}}
      &lt;/mat-card-title&gt;
      &lt;mat-card-content&gt;
        {{ '{{' }}step?.content}}
      &lt;/mat-card-content&gt;
      &lt;mat-card-actions&gt;
        &lt;button mat-icon-button [disabled]="!tourService.hasPrev(step)" (click)="tourService.prev()"&gt;
          &lt;mat-icon&gt;chevron_left&lt;/mat-icon&gt;
        &lt;/button&gt;
        &lt;button mat-icon-button [disabled]="!tourService.hasNext(step)" (click)="tourService.next()"&gt;
          &lt;mat-icon&gt;chevron_right&lt;/mat-icon&gt;
        &lt;/button&gt;
        &lt;button mat-button (click)="tourService.end()"&gt;{{ '{{' }}step?.endBtnTitle}}&lt;/button&gt;
      &lt;/mat-card-actions&gt;
    &lt;/mat-card&gt;
  &lt;/ng-template&gt;
&lt;/tour-step-template&gt;
</code></pre>

<h2>Styling Active Tour Anchor</h2>
<p>
  The currently active tour anchor element has a
  <code>touranchor--is-active</code> class applied to it, so you can apply your own custom styles to that class to highlight the element being referenced.
</p>
